<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <title>Lemmy Mobile</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üêÄ</text></svg>">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        :root {
            --primary: #FF4500;
            --primary-dark: #CC3700;
            --accent: #0079D3;
            --accent-dark: #0056A3;
            --bg-primary: #FFFFFF;
            --bg-secondary: #F6F7F8;
            --bg-tertiary: #DAE0E6;
            --text-primary: #1C1C1C;
            --text-secondary: #7C7C7C;
            --text-tertiary: #9CA3AF;
            --border: #EDEFF1;
            --border-dark: #D1D5DB;
            --upvote: #FF4500;
            --downvote: #7193FF;
            --success: #46D160;
            --error: #EA4435;
            --shadow-sm: 0 1px 2px rgba(0,0,0,0.08);
            --shadow-md: 0 2px 8px rgba(0,0,0,0.12);
            --shadow-lg: 0 4px 16px rgba(0,0,0,0.16);
        }

        [data-theme="dark"] {
            --bg-primary: #1A1A1B;
            --bg-secondary: #272729;
            --bg-tertiary: #000000;
            --text-primary: #D7DADC;
            --text-secondary: #818384;
            --text-tertiary: #6B7280;
            --border: #343536;
            --border-dark: #4E4F50;
            --shadow-sm: 0 1px 2px rgba(0,0,0,0.3);
            --shadow-md: 0 2px 8px rgba(0,0,0,0.4);
            --shadow-lg: 0 4px 16px rgba(0,0,0,0.5);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: var(--bg-secondary);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
            -webkit-font-smoothing: antialiased;
        }

        .app {
            max-width: 100vw;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* Header */
        .header {
            background: var(--bg-primary);
            border-bottom: 1px solid var(--border);
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: var(--shadow-sm);
        }

        .header-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px 16px;
            height: 52px;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .menu-btn,
        .user-btn {
            background: none;
            border: none;
            padding: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-primary);
            border-radius: 8px;
            transition: background 0.2s;
            position: relative;
        }

        .menu-btn:active,
        .user-btn:active {
            background: var(--bg-secondary);
        }

        .notification-badge {
            position: absolute;
            top: 4px;
            right: 4px;
            background: var(--error);
            color: white;
            font-size: 10px;
            font-weight: 700;
            padding: 2px 4px;
            border-radius: 10px;
            min-width: 16px;
            text-align: center;
        }

        .logo {
            font-size: 22px;
            font-weight: 700;
            color: var(--primary);
            letter-spacing: -0.5px;
        }

        .search-bar {
            flex: 1;
            max-width: 500px;
            margin: 0 12px;
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 24px;
            padding: 8px 16px;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: border-color 0.2s;
        }

        .search-bar:focus-within {
            border-color: var(--accent);
        }

        .search-bar input {
            flex: 1;
            background: none;
            border: none;
            outline: none;
            color: var(--text-primary);
            font-size: 14px;
        }

        .search-bar input::placeholder {
            color: var(--text-tertiary);
        }

        .user-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 14px;
        }

        /* Feed Tabs */
        .feed-tabs {
            background: var(--bg-primary);
            border-bottom: 1px solid var(--border);
            display: flex;
            overflow-x: auto;
            scrollbar-width: none;
            -webkit-overflow-scrolling: touch;
        }

        .feed-tabs::-webkit-scrollbar {
            display: none;
        }

        .feed-tab {
            padding: 14px 20px;
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            white-space: nowrap;
            position: relative;
            transition: color 0.2s;
            text-transform: capitalize;
        }

        .feed-tab:hover {
            color: var(--text-primary);
        }

        .feed-tab.active {
            color: var(--text-primary);
        }

        .feed-tab.active::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: var(--accent);
            border-radius: 3px 3px 0 0;
        }

        /* Sort Bar */
        .sort-bar {
            background: var(--bg-primary);
            padding: 10px 16px;
            display: flex;
            gap: 8px;
            overflow-x: auto;
            scrollbar-width: none;
            border-bottom: 1px solid var(--border);
        }

        .sort-bar::-webkit-scrollbar {
            display: none;
        }

        .sort-btn {
            padding: 6px 14px;
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 18px;
            font-size: 13px;
            font-weight: 500;
            color: var(--text-secondary);
            cursor: pointer;
            white-space: nowrap;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .sort-btn:hover {
            border-color: var(--border-dark);
        }

        .sort-btn.active {
            background: var(--accent);
            color: white;
            border-color: var(--accent);
        }

        /* Content */
        .content {
            flex: 1;
            padding-bottom: 60px;
            min-height: calc(100vh - 200px);
        }

        /* Post Card */
        .post {
            background: var(--bg-primary);
            border-bottom: 1px solid var(--border);
            cursor: pointer;
            transition: background 0.2s;
        }

        .post:active {
            background: var(--bg-secondary);
        }

        .post-content {
            padding: 12px 16px;
        }

        .post-meta {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 10px;
            font-size: 12px;
            color: var(--text-secondary);
        }

        .community-icon {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--accent), var(--primary));
        }

        .post-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 8px;
            line-height: 1.4;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .post-body {
            font-size: 14px;
            color: var(--text-secondary);
            line-height: 1.5;
            margin-bottom: 10px;
            display: -webkit-box;
            -webkit-line-clamp: 4;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .post-image {
            width: calc(100% + 32px);
            margin: 0 -16px 10px -16px;
            max-height: 512px;
            object-fit: cover;
            background: var(--bg-secondary);
        }

        .post-image.full {
            max-height: none;
            object-fit: contain;
        }

        .post-actions {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 8px 0;
        }

        .vote-group {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .vote-btn {
            background: none;
            border: none;
            padding: 6px;
            cursor: pointer;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 4px;
            transition: all 0.2s;
        }

        .vote-btn:hover {
            background: var(--bg-secondary);
        }

        .vote-btn.upvoted {
            color: var(--upvote);
        }

        .vote-btn.downvoted {
            color: var(--downvote);
        }

        .vote-count {
            font-size: 13px;
            font-weight: 600;
            color: var(--text-primary);
            min-width: 30px;
            text-align: center;
        }

        .post-action-btn {
            display: flex;
            align-items: center;
            gap: 4px;
            padding: 6px 10px;
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            border-radius: 4px;
            transition: background 0.2s;
        }

        .post-action-btn:hover {
            background: var(--bg-secondary);
        }

        /* Notifications */
        .notification-item {
            background: var(--bg-primary);
            border-bottom: 1px solid var(--border);
            padding: 12px 16px;
            cursor: pointer;
            transition: background 0.2s;
        }

        .notification-item:hover {
            background: var(--bg-secondary);
        }

        .notification-item.unread {
            border-left: 3px solid var(--primary);
        }

        .notification-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 8px;
            font-size: 13px;
            color: var(--text-secondary);
        }

        .notification-type {
            padding: 2px 8px;
            background: var(--accent);
            color: white;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .notification-content {
            font-size: 14px;
            color: var(--text-primary);
            line-height: 1.4;
        }

        .notification-meta {
            margin-top: 8px;
            font-size: 12px;
            color: var(--text-tertiary);
        }

        /* Bottom Navigation */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--bg-primary);
            border-top: 1px solid var(--border);
            display: flex;
            justify-content: space-around;
            padding: 8px 0;
            z-index: 100;
        }

        .nav-item {
            flex: 1;
            background: none;
            border: none;
            padding: 6px;
            color: var(--text-tertiary);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            cursor: pointer;
            transition: color 0.2s;
            position: relative;
        }

        .nav-item:active {
            transform: scale(0.95);
        }

        .nav-item.active {
            color: var(--accent);
        }

        .nav-icon {
            font-size: 20px;
        }

        .nav-label {
            font-size: 11px;
            font-weight: 500;
        }

        .nav-badge {
            position: absolute;
            top: 2px;
            right: calc(50% - 16px);
            background: var(--error);
            color: white;
            font-size: 9px;
            font-weight: 700;
            padding: 1px 4px;
            border-radius: 8px;
            min-width: 14px;
            text-align: center;
        }

        /* Loading */
        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 40px;
        }

        .spinner {
            width: 36px;
            height: 36px;
            border: 3px solid var(--border);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.6);
            z-index: 1000;
            padding: 20px;
            overflow-y: auto;
        }

        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: var(--bg-primary);
            border-radius: 16px;
            width: 100%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: var(--shadow-lg);
        }

        .modal-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 20px;
            border-bottom: 1px solid var(--border);
        }

        .modal-title {
            font-size: 20px;
            font-weight: 700;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 24px;
            color: var(--text-secondary);
            cursor: pointer;
            padding: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            transition: background 0.2s;
        }

        .modal-close:hover {
            background: var(--bg-secondary);
        }

        .modal-body {
            padding: 20px;
        }

        /* Forms */
        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .form-input,
        .form-textarea,
        .form-select {
            width: 100%;
            padding: 12px 16px;
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 12px;
            color: var(--text-primary);
            font-size: 15px;
            font-family: inherit;
            outline: none;
            transition: all 0.2s;
        }

        .form-input:focus,
        .form-textarea:focus,
        .form-select:focus {
            border-color: var(--accent);
            background: var(--bg-primary);
        }

        .form-textarea {
            min-height: 120px;
            resize: vertical;
        }

        .btn {
            width: 100%;
            padding: 14px 20px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn:hover {
            background: var(--primary-dark);
        }

        .btn:active {
            transform: scale(0.98);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn-secondary {
            background: var(--bg-secondary);
            color: var(--text-primary);
        }

        .btn-secondary:hover {
            background: var(--bg-tertiary);
        }

        /* Drawer */
        .drawer {
            position: fixed;
            top: 0;
            left: -100%;
            width: 280px;
            height: 100%;
            background: var(--bg-primary);
            box-shadow: var(--shadow-lg);
            transition: left 0.3s ease;
            z-index: 1001;
            overflow-y: auto;
        }

        .drawer.active {
            left: 0;
        }

        .drawer-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.4);
            z-index: 1000;
        }

        .drawer-overlay.active {
            display: block;
        }

        .drawer-header {
            padding: 20px;
            border-bottom: 1px solid var(--border);
        }

        .drawer-user {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .drawer-avatar {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 18px;
        }

        .drawer-username {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .drawer-instance {
            font-size: 12px;
            color: var(--text-secondary);
        }

        .drawer-menu {
            padding: 12px 0;
        }

        .drawer-item {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 14px 20px;
            color: var(--text-primary);
            text-decoration: none;
            background: none;
            border: none;
            width: 100%;
            text-align: left;
            font-size: 15px;
            cursor: pointer;
            transition: background 0.2s;
        }

        .drawer-item:hover {
            background: var(--bg-secondary);
        }

        .drawer-icon {
            font-size: 20px;
            width: 24px;
            text-align: center;
        }

        .drawer-divider {
            height: 1px;
            background: var(--border);
            margin: 8px 0;
        }

        /* Post Detail */
        .post-detail {
            background: var(--bg-primary);
            min-height: 100vh;
        }

        .post-detail-content {
            padding: 16px;
        }

        .post-detail-title {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 12px;
            line-height: 1.3;
            color: var(--text-primary);
        }

        .post-detail-body {
            font-size: 15px;
            line-height: 1.6;
            color: var(--text-primary);
            margin-bottom: 16px;
        }

        .post-detail-image {
            width: calc(100% + 32px);
            margin: 0 -16px 16px -16px;
        }

        /* Comments */
        .comments-section {
            padding: 0 16px 16px;
        }

        .comments-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 16px;
            padding-bottom: 12px;
            border-bottom: 1px solid var(--border);
        }

        .comments-title {
            font-size: 18px;
            font-weight: 700;
            color: var(--text-primary);
        }

        .comment {
            margin-bottom: 16px;
            padding-left: 12px;
            border-left: 2px solid var(--border);
        }

        .comment.depth-1 { margin-left: 16px; }
        .comment.depth-2 { margin-left: 32px; }
        .comment.depth-3 { margin-left: 48px; }
        .comment.depth-4 { margin-left: 64px; }

        .comment-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 8px;
            font-size: 13px;
            color: var(--text-secondary);
        }

        .comment-author {
            font-weight: 600;
            color: var(--text-primary);
        }

        .comment-body {
            font-size: 14px;
            line-height: 1.5;
            color: var(--text-primary);
            margin-bottom: 8px;
        }

        .comment-actions {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        /* Reply Box */
        .reply-box {
            padding: 16px;
            background: var(--bg-secondary);
            border-radius: 12px;
            margin: 16px;
        }

        .reply-textarea {
            width: 100%;
            min-height: 100px;
            padding: 12px;
            background: var(--bg-primary);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text-primary);
            font-size: 14px;
            font-family: inherit;
            resize: vertical;
            outline: none;
            transition: border-color 0.2s;
        }

        .reply-textarea:focus {
            border-color: var(--accent);
        }

        .reply-actions {
            display: flex;
            gap: 8px;
            margin-top: 12px;
        }

        .reply-btn {
            padding: 10px 20px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.2s;
        }

        .reply-btn:hover {
            background: var(--primary-dark);
        }

        .cancel-btn {
            padding: 10px 20px;
            background: var(--bg-tertiary);
            color: var(--text-primary);
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.2s;
        }

        /* Markdown Content */
        .markdown img {
            max-width: 100%;
            height: auto;
            border-radius: 8px;
            margin: 12px 0;
            display: block;
        }

        .markdown a {
            color: var(--accent);
            text-decoration: none;
        }

        .markdown a:hover {
            text-decoration: underline;
        }

        .markdown h1, .markdown h2, .markdown h3 {
            margin: 16px 0 8px 0;
            font-weight: 700;
        }

        .markdown p {
            margin: 12px 0;
        }

        .markdown ul, .markdown ol {
            margin: 12px 0;
            padding-left: 24px;
        }

        .markdown blockquote {
            border-left: 3px solid var(--border);
            padding-left: 16px;
            margin: 12px 0;
            color: var(--text-secondary);
        }

        .markdown code {
            background: var(--bg-secondary);
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
        }

        .markdown pre {
            background: var(--bg-secondary);
            padding: 12px;
            border-radius: 8px;
            overflow-x: auto;
            margin: 12px 0;
        }

        .markdown pre code {
            background: none;
            padding: 0;
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-secondary);
        }

        .empty-icon {
            font-size: 48px;
            margin-bottom: 16px;
            opacity: 0.5;
        }

        .empty-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--text-primary);
        }

        .empty-text {
            font-size: 14px;
            color: var(--text-secondary);
        }

        /* Toast */
        .toast {
            position: fixed;
            bottom: 80px;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: var(--bg-primary);
            color: var(--text-primary);
            padding: 12px 20px;
            border-radius: 24px;
            box-shadow: var(--shadow-lg);
            font-size: 14px;
            font-weight: 500;
            z-index: 2000;
            opacity: 0;
            transition: all 0.3s ease;
            pointer-events: none;
        }

        .toast.show {
            transform: translateX(-50%) translateY(0);
            opacity: 1;
            pointer-events: auto;
        }

        /* FAB */
        .fab {
            position: fixed;
            bottom: 76px;
            right: 16px;
            width: 56px;
            height: 56px;
            border-radius: 50%;
            background: var(--primary);
            color: white;
            border: none;
            box-shadow: var(--shadow-lg);
            font-size: 24px;
            cursor: pointer;
            z-index: 99;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .fab:hover {
            background: var(--primary-dark);
            transform: scale(1.05);
        }

        .fab:active {
            transform: scale(0.95);
        }

        /* Responsive */
        @media (min-width: 768px) {
            .app {
                max-width: 768px;
                margin: 0 auto;
                box-shadow: var(--shadow-lg);
            }
        }

        /* Accessibility */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--bg-secondary);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--border-dark);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--text-tertiary);
        }
    </style>
</head>
<body>
    <div class="app">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <div class="header-left">
                    <button class="menu-btn" onclick="app.toggleDrawer()" aria-label="Menu">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M3 12h18M3 6h18M3 18h18"/>
                        </svg>
                    </button>
                    <div class="logo">Lemmy</div>
                </div>
                <div class="search-bar">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="11" cy="11" r="8"/>
                        <path d="m21 21-4.35-4.35"/>
                    </svg>
                    <input type="search" placeholder="Search" id="searchInput">
                </div>
                <button class="user-btn" onclick="app.toggleUserMenu()" aria-label="User">
                    <div class="user-avatar" id="userAvatar">?</div>
                    <span class="notification-badge" id="headerNotificationBadge" style="display: none;">0</span>
                </button>
            </div>
        </header>

        <!-- Feed Tabs -->
        <div class="feed-tabs">
            <button class="feed-tab active" data-feed="Local" onclick="app.switchFeed('Local')">Local</button>
            <button class="feed-tab" data-feed="All" onclick="app.switchFeed('All')">All</button>
            <button class="feed-tab" data-feed="Subscribed" onclick="app.switchFeed('Subscribed')">Subscribed</button>
        </div>

        <!-- Sort Bar -->
        <div class="sort-bar">
            <button class="sort-btn active" data-sort="Hot" onclick="app.switchSort('Hot')">üî• Hot</button>
            <button class="sort-btn" data-sort="Active" onclick="app.switchSort('Active')">‚ö° Active</button>
            <button class="sort-btn" data-sort="New" onclick="app.switchSort('New')">üÜï New</button>
            <button class="sort-btn" data-sort="TopDay" onclick="app.switchSort('TopDay')">üìà Top Day</button>
            <button class="sort-btn" data-sort="TopWeek" onclick="app.switchSort('TopWeek')">üìä Top Week</button>
            <button class="sort-btn" data-sort="MostComments" onclick="app.switchSort('MostComments')">üí¨ Comments</button>
        </div>

        <!-- Main Content -->
        <main class="content" id="content">
            <div class="loading">
                <div class="spinner"></div>
            </div>
        </main>

        <!-- FAB -->
        <button class="fab" onclick="app.showCreatePost()" aria-label="Create Post">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3">
                <path d="M12 5v14M5 12h14"/>
            </svg>
        </button>

        <!-- Bottom Navigation -->
        <nav class="bottom-nav">
            <button class="nav-item active" data-page="feed" onclick="app.navigate('feed')">
                <span class="nav-icon">üè†</span>
                <span class="nav-label">Feed</span>
            </button>
            <button class="nav-item" data-page="communities" onclick="app.navigate('communities')">
                <span class="nav-icon">üë•</span>
                <span class="nav-label">Communities</span>
            </button>
            <button class="nav-item" data-page="search" onclick="app.navigate('search')">
                <span class="nav-icon">üîç</span>
                <span class="nav-label">Search</span>
            </button>
            <button class="nav-item" data-page="inbox" onclick="app.navigate('inbox')">
                <span class="nav-icon">üì¨</span>
                <span class="nav-label">Inbox</span>
                <span class="nav-badge" id="inboxBadge" style="display: none;">0</span>
            </button>
            <button class="nav-item" data-page="profile" onclick="app.navigate('profile')">
                <span class="nav-icon">üë§</span>
                <span class="nav-label">Profile</span>
            </button>
        </nav>

        <!-- Drawer -->
        <div class="drawer-overlay" id="drawerOverlay" onclick="app.toggleDrawer()"></div>
        <div class="drawer" id="drawer">
            <div class="drawer-header">
                <div class="drawer-user">
                    <div class="drawer-avatar" id="drawerAvatar">?</div>
                    <div>
                        <div class="drawer-username" id="drawerUsername">Guest</div>
                        <div class="drawer-instance" id="drawerInstance">Not logged in</div>
                    </div>
                </div>
            </div>
            <div class="drawer-menu">
                <button class="drawer-item" onclick="app.navigate('profile'); app.toggleDrawer()">
                    <span class="drawer-icon">üë§</span>
                    <span>Profile</span>
                </button>
                <button class="drawer-item" onclick="app.navigate('saved'); app.toggleDrawer()">
                    <span class="drawer-icon">üîñ</span>
                    <span>Saved</span>
                </button>
                <button class="drawer-item" onclick="app.navigate('settings'); app.toggleDrawer()">
                    <span class="drawer-icon">‚öôÔ∏è</span>
                    <span>Settings</span>
                </button>
                <div class="drawer-divider"></div>
                <button class="drawer-item" onclick="app.toggleTheme()">
                    <span class="drawer-icon">üåô</span>
                    <span>Dark Mode</span>
                </button>
                <button class="drawer-item" onclick="app.showInstanceModal()">
                    <span class="drawer-icon">üåê</span>
                    <span>Change Instance</span>
                </button>
                <div class="drawer-divider"></div>
                <button class="drawer-item" id="authBtn" onclick="app.handleAuth()">
                    <span class="drawer-icon">üîë</span>
                    <span>Login</span>
                </button>
            </div>
        </div>

        <!-- Login Modal -->
        <div class="modal" id="loginModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 class="modal-title">Login to Lemmy</h2>
                    <button class="modal-close" onclick="app.closeModal('loginModal')">√ó</button>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <label class="form-label">Instance</label>
                        <input type="text" class="form-input" id="instanceInput" value="lemmy.world" placeholder="lemmy.world">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Username or Email</label>
                        <input type="text" class="form-input" id="usernameInput" placeholder="Enter username or email">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Password</label>
                        <input type="password" class="form-input" id="passwordInput" placeholder="Enter password">
                    </div>
                    <button class="btn" onclick="app.login()">Login</button>
                    <button class="btn btn-secondary" style="margin-top: 12px" onclick="app.showRegisterModal()">Create Account</button>
                </div>
            </div>
        </div>

        <!-- Create Post Modal -->
        <div class="modal" id="createPostModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 class="modal-title">Create Post</h2>
                    <button class="modal-close" onclick="app.closeModal('createPostModal')">√ó</button>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <label class="form-label">Community</label>
                        <select class="form-select" id="postCommunity">
                            <option value="">Select a community</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Title</label>
                        <input type="text" class="form-input" id="postTitle" placeholder="Enter post title">
                    </div>
                    <div class="form-group">
                        <label class="form-label">URL (optional)</label>
                        <input type="url" class="form-input" id="postUrl" placeholder="https://example.com">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Body (optional - Markdown supported)</label>
                        <textarea class="form-textarea" id="postBody" placeholder="Write your post content here..."></textarea>
                    </div>
                    <button class="btn" onclick="app.createPost()">Submit Post</button>
                </div>
            </div>
        </div>

        <!-- Toast -->
        <div class="toast" id="toast"></div>
    </div>

    <script>
        // Lemmy API Client
        class LemmyAPI {
            constructor(instanceUrl = 'https://lemmy.world') {
                this.baseUrl = instanceUrl;
                this.auth = null;
            }

            async request(endpoint, options = {}) {
                const url = `${this.baseUrl}/api/v3${endpoint}`;
                
                try {
                    const response = await fetch(url, {
                        ...options,
                        headers: {
                            'Content-Type': 'application/json',
                            ...options.headers
                        }
                    });
                    
                    if (!response.ok) {
                        throw new Error(`API Error: ${response.status}`);
                    }
                    
                    return await response.json();
                } catch (error) {
                    console.error('API Request failed:', error);
                    throw error;
                }
            }

            // Auth endpoints
            async login(username_or_email, password) {
                const response = await this.request('/user/login', {
                    method: 'POST',
                    body: JSON.stringify({ username_or_email, password })
                });
                
                if (response.jwt) {
                    this.auth = response.jwt;
                    localStorage.setItem('lemmy_jwt', this.auth);
                }
                
                return response;
            }

            // Post endpoints
            async getPosts(params = {}) {
                const queryParams = new URLSearchParams();
                
                // Required params
                queryParams.append('type_', params.type_ || 'Local');
                queryParams.append('sort', params.sort || 'Hot');
                queryParams.append('page', params.page || 1);
                queryParams.append('limit', params.limit || 20);
                
                // Add auth if available
                if (this.auth) {
                    queryParams.append('auth', this.auth);
                }
                
                return await this.request(`/post/list?${queryParams}`);
            }

            async getPost(id) {
                const queryParams = new URLSearchParams({ id });
                if (this.auth) queryParams.append('auth', this.auth);
                return await this.request(`/post?${queryParams}`);
            }

            async createPost(params) {
                return await this.request('/post', {
                    method: 'POST',
                    body: JSON.stringify({
                        ...params,
                        auth: this.auth
                    })
                });
            }

            async likePost(post_id, score) {
                return await this.request('/post/like', {
                    method: 'POST',
                    body: JSON.stringify({
                        post_id,
                        score,
                        auth: this.auth
                    })
                });
            }

            async savePost(post_id, save) {
                return await this.request('/post/save', {
                    method: 'PUT',
                    body: JSON.stringify({
                        post_id,
                        save,
                        auth: this.auth
                    })
                });
            }

            // Comment endpoints
            async getComments(params = {}) {
                const queryParams = new URLSearchParams();
                
                if (params.post_id) queryParams.append('post_id', params.post_id);
                queryParams.append('type_', params.type_ || 'All');
                queryParams.append('sort', params.sort || 'Hot');
                queryParams.append('page', params.page || 1);
                queryParams.append('limit', params.limit || 50);
                
                if (this.auth) queryParams.append('auth', this.auth);
                
                return await this.request(`/comment/list?${queryParams}`);
            }

            async createComment(params) {
                return await this.request('/comment', {
                    method: 'POST',
                    body: JSON.stringify({
                        ...params,
                        auth: this.auth
                    })
                });
            }

            async likeComment(comment_id, score) {
                return await this.request('/comment/like', {
                    method: 'POST',
                    body: JSON.stringify({
                        comment_id,
                        score,
                        auth: this.auth
                    })
                });
            }

            // Community endpoints
            async getCommunities(params = {}) {
                const queryParams = new URLSearchParams();
                
                queryParams.append('type_', params.type_ || 'Local');
                queryParams.append('sort', params.sort || 'TopAll');
                queryParams.append('page', params.page || 1);
                queryParams.append('limit', params.limit || 50);
                
                if (this.auth) queryParams.append('auth', this.auth);
                
                return await this.request(`/community/list?${queryParams}`);
            }

            async getCommunity(id) {
                const queryParams = new URLSearchParams({ id });
                if (this.auth) queryParams.append('auth', this.auth);
                return await this.request(`/community?${queryParams}`);
            }

            async followCommunity(community_id, follow) {
                return await this.request('/community/follow', {
                    method: 'POST',
                    body: JSON.stringify({
                        community_id,
                        follow,
                        auth: this.auth
                    })
                });
            }

            // User endpoints
            async getPersonDetails(person_id) {
                const queryParams = new URLSearchParams({ person_id });
                if (this.auth) queryParams.append('auth', this.auth);
                return await this.request(`/user?${queryParams}`);
            }

            async getSite() {
                const queryParams = new URLSearchParams();
                if (this.auth) queryParams.append('auth', this.auth);
                return await this.request(`/site?${queryParams}`);
            }

            // Notification endpoints
            async getReplies(params = {}) {
                const queryParams = new URLSearchParams();
                queryParams.append('sort', params.sort || 'New');
                queryParams.append('unread_only', params.unread_only || false);
                queryParams.append('page', params.page || 1);
                queryParams.append('limit', params.limit || 20);
                
                if (this.auth) queryParams.append('auth', this.auth);
                
                return await this.request(`/user/replies?${queryParams}`);
            }

            async getMentions(params = {}) {
                const queryParams = new URLSearchParams();
                queryParams.append('sort', params.sort || 'New');
                queryParams.append('unread_only', params.unread_only || false);
                queryParams.append('page', params.page || 1);
                queryParams.append('limit', params.limit || 20);
                
                if (this.auth) queryParams.append('auth', this.auth);
                
                return await this.request(`/user/mention?${queryParams}`);
            }

            async getPrivateMessages(params = {}) {
                const queryParams = new URLSearchParams();
                queryParams.append('unread_only', params.unread_only || false);
                queryParams.append('page', params.page || 1);
                queryParams.append('limit', params.limit || 20);
                
                if (this.auth) queryParams.append('auth', this.auth);
                
                return await this.request(`/private_message/list?${queryParams}`);
            }

            async markReplyAsRead(comment_reply_id, read) {
                return await this.request('/comment/mark_as_read', {
                    method: 'POST',
                    body: JSON.stringify({
                        comment_reply_id,
                        read,
                        auth: this.auth
                    })
                });
            }

            async markMentionAsRead(person_mention_id, read) {
                return await this.request('/user/mention/mark_as_read', {
                    method: 'POST',
                    body: JSON.stringify({
                        person_mention_id,
                        read,
                        auth: this.auth
                    })
                });
            }

            async markPrivateMessageAsRead(private_message_id, read) {
                return await this.request('/private_message/mark_as_read', {
                    method: 'POST',
                    body: JSON.stringify({
                        private_message_id,
                        read,
                        auth: this.auth
                    })
                });
            }

            async getUnreadCount() {
                const queryParams = new URLSearchParams();
                if (this.auth) queryParams.append('auth', this.auth);
                return await this.request(`/user/unread_count?${queryParams}`);
            }
        }

        // Main App
        class LemmyApp {
            constructor() {
                this.api = new LemmyAPI();
                this.currentView = 'feed';
                this.currentFeed = 'Local';
                this.currentSort = 'Hot';
                this.currentPage = 1;
                this.posts = [];
                this.communities = [];
                this.subscribedCommunities = [];
                this.currentPost = null;
                this.currentUser = null;
                this.isLoading = false;
                this.notifications = {
                    replies: [],
                    mentions: [],
                    messages: []
                };
                this.unreadCount = 0;
                this.notificationInterval = null;
                
                this.init();
            }

            async init() {
                // Load saved auth
                const savedAuth = localStorage.getItem('lemmy_jwt');
                const savedInstance = localStorage.getItem('lemmy_instance');
                const savedUser = localStorage.getItem('lemmy_user');
                
                if (savedInstance) {
                    this.api.baseUrl = savedInstance;
                }
                
                if (savedAuth) {
                    this.api.auth = savedAuth;
                    if (savedUser) {
                        try {
                            this.currentUser = JSON.parse(savedUser);
                            this.updateUserUI();
                            
                            // Load subscribed communities
                            await this.loadSubscribedCommunities();
                            
                            // Start notification polling
                            this.startNotificationPolling();
                        } catch (e) {
                            console.error('Failed to parse saved user');
                        }
                    }
                }
                
                // Load saved theme
                const savedTheme = localStorage.getItem('theme');
                if (savedTheme === 'dark') {
                    document.body.dataset.theme = 'dark';
                }
                
                // Setup infinite scroll
                window.addEventListener('scroll', () => {
                    if (window.innerHeight + window.scrollY >= document.body.offsetHeight - 1000) {
                        if (!this.isLoading && this.currentView === 'feed') {
                            this.loadMorePosts();
                        }
                    }
                });
                
                // Load initial posts
                await this.loadPosts();
            }

            // Navigation
            navigate(page) {
                document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
                document.querySelector(`[data-page="${page}"]`)?.classList.add('active');
                
                this.currentView = page;
                
                switch(page) {
                    case 'feed':
                        this.loadPosts();
                        break;
                    case 'communities':
                        this.loadCommunities();
                        break;
                    case 'search':
                        this.showSearch();
                        break;
                    case 'inbox':
                        this.showInbox();
                        break;
                    case 'profile':
                        this.showProfile();
                        break;
                    case 'saved':
                        this.showSaved();
                        break;
                    case 'settings':
                        this.showSettings();
                        break;
                }
            }

            // Feed Management
            switchFeed(feed) {
                document.querySelectorAll('.feed-tab').forEach(tab => tab.classList.remove('active'));
                document.querySelector(`[data-feed="${feed}"]`).classList.add('active');
                
                this.currentFeed = feed;
                this.currentPage = 1;
                this.posts = [];
                this.loadPosts();
            }

            switchSort(sort) {
                document.querySelectorAll('.sort-btn').forEach(btn => btn.classList.remove('active'));
                document.querySelector(`[data-sort="${sort}"]`).classList.add('active');
                
                this.currentSort = sort;
                this.currentPage = 1;
                this.posts = [];
                this.loadPosts();
            }

            // Post Loading
            async loadPosts() {
                if (this.isLoading) return;
                
                // Check if Subscribed feed requires auth
                if (this.currentFeed === 'Subscribed' && !this.api.auth) {
                    const content = document.getElementById('content');
                    content.innerHTML = `
                        <div class="empty-state">
                            <div class="empty-icon">üîí</div>
                            <div class="empty-title">Login Required</div>
                            <div class="empty-text">You need to login to view your subscribed communities</div>
                            <button class="btn" style="max-width: 200px; margin: 20px auto;" onclick="app.openModal('loginModal')">Login</button>
                        </div>
                    `;
                    return;
                }
                
                this.isLoading = true;
                
                const content = document.getElementById('content');
                if (this.currentPage === 1) {
                    content.innerHTML = '<div class="loading"><div class="spinner"></div></div>';
                }
                
                try {
                    const response = await this.api.getPosts({
                        type_: this.currentFeed,
                        sort: this.currentSort,
                        page: this.currentPage,
                        limit: 20
                    });
                    
                    if (this.currentPage === 1) {
                        this.posts = response.posts || [];
                    } else {
                        this.posts = [...this.posts, ...(response.posts || [])];
                    }
                    
                    this.renderPosts();
                } catch (error) {
                    this.showToast('Failed to load posts');
                    if (this.currentPage === 1) {
                        content.innerHTML = `
                            <div class="empty-state">
                                <div class="empty-icon">‚ùå</div>
                                <div class="empty-title">Failed to load posts</div>
                                <div class="empty-text">Please check your connection and try again</div>
                            </div>
                        `;
                    }
                } finally {
                    this.isLoading = false;
                }
            }

            async loadMorePosts() {
                if (!this.isLoading) {
                    this.currentPage++;
                    await this.loadPosts();
                }
            }

            async loadSubscribedCommunities() {
                if (!this.api.auth) return;
                
                try {
                    const response = await this.api.getCommunities({
                        type_: 'Subscribed',
                        limit: 100
                    });
                    
                    this.subscribedCommunities = response.communities || [];
                } catch (error) {
                    console.error('Failed to load subscribed communities');
                }
            }

            renderPosts() {
                const content = document.getElementById('content');
                
                if (this.posts.length === 0) {
                    content.innerHTML = `
                        <div class="empty-state">
                            <div class="empty-icon">üì≠</div>
                            <div class="empty-title">No posts yet</div>
                            <div class="empty-text">${this.currentFeed === 'Subscribed' ? 'Subscribe to communities to see posts here' : 'Be the first to post!'}</div>
                        </div>
                    `;
                    return;
                }
                
                const postsHTML = this.posts.map(postView => {
                    const post = postView.post;
                    const creator = postView.creator;
                    const community = postView.community;
                    const counts = postView.counts;
                    
                    // Parse body for preview
                    let bodyPreview = '';
                    if (post.body) {
                        bodyPreview = this.parseMarkdown(post.body.substring(0, 300));
                    }
                    
                    // Handle images
                    let imageHTML = '';
                    if (post.thumbnail_url) {
                        imageHTML = `<img class="post-image" src="${post.thumbnail_url}" alt="" loading="lazy">`;
                    } else if (post.url && post.url.match(/\.(jpg|jpeg|png|gif|webp)$/i)) {
                        imageHTML = `<img class="post-image" src="${post.url}" alt="" loading="lazy">`;
                    }
                    
                    return `
                        <div class="post" onclick="app.viewPost(${post.id})">
                            <div class="post-content">
                                <div class="post-meta">
                                    <div class="community-icon"></div>
                                    <span>c/${community.name}</span>
                                    <span>‚Ä¢</span>
                                    <span>u/${creator.name}</span>
                                    <span>‚Ä¢</span>
                                    <span>${this.formatTime(post.published)}</span>
                                </div>
                                <h2 class="post-title">${this.escapeHtml(post.name)}</h2>
                                ${bodyPreview ? `<div class="post-body markdown">${bodyPreview}</div>` : ''}
                            </div>
                            ${imageHTML}
                            <div class="post-actions">
                                <div class="vote-group">
                                    <button class="vote-btn ${postView.my_vote === 1 ? 'upvoted' : ''}" 
                                            onclick="event.stopPropagation(); app.votePost(${post.id}, ${postView.my_vote === 1 ? 0 : 1})">
                                        ‚ñ≤
                                    </button>
                                    <span class="vote-count">${this.formatCount(counts.score)}</span>
                                    <button class="vote-btn ${postView.my_vote === -1 ? 'downvoted' : ''}" 
                                            onclick="event.stopPropagation(); app.votePost(${post.id}, ${postView.my_vote === -1 ? 0 : -1})">
                                        ‚ñº
                                    </button>
                                </div>
                                <button class="post-action-btn" onclick="event.stopPropagation(); app.viewPost(${post.id})">
                                    üí¨ ${this.formatCount(counts.comments)}
                                </button>
                                <button class="post-action-btn" onclick="event.stopPropagation(); app.sharePost(${post.id})">
                                    üîó Share
                                </button>
                                <button class="post-action-btn" onclick="event.stopPropagation(); app.savePost(${post.id}, ${!postView.saved})">
                                    ${postView.saved ? 'üîñ' : 'üìë'} Save
                                </button>
                            </div>
                        </div>
                    `;
                }).join('');
                
                if (this.currentPage === 1) {
                    content.innerHTML = postsHTML;
                } else {
                    content.insertAdjacentHTML('beforeend', postsHTML);
                }
            }

            // Notifications
            async startNotificationPolling() {
                if (!this.api.auth) return;
                
                // Initial check
                await this.checkNotifications();
                
                // Poll every 30 seconds
                this.notificationInterval = setInterval(() => {
                    this.checkNotifications();
                }, 30000);
            }

            async checkNotifications() {
                if (!this.api.auth) return;
                
                try {
                    const response = await this.api.getUnreadCount();
                    this.unreadCount = (response.replies || 0) + (response.mentions || 0) + (response.private_messages || 0);
                    this.updateNotificationBadges();
                } catch (error) {
                    console.error('Failed to check notifications');
                }
            }

            updateNotificationBadges() {
                const headerBadge = document.getElementById('headerNotificationBadge');
                const inboxBadge = document.getElementById('inboxBadge');
                
                if (this.unreadCount > 0) {
                    headerBadge.textContent = this.unreadCount;
                    headerBadge.style.display = 'block';
                    inboxBadge.textContent = this.unreadCount;
                    inboxBadge.style.display = 'block';
                } else {
                    headerBadge.style.display = 'none';
                    inboxBadge.style.display = 'none';
                }
            }

            async showInbox() {
                const content = document.getElementById('content');
                
                if (!this.api.auth) {
                    content.innerHTML = `
                        <div class="empty-state">
                            <div class="empty-icon">üîí</div>
                            <div class="empty-title">Login Required</div>
                            <div class="empty-text">You need to login to view your inbox</div>
                            <button class="btn" style="max-width: 200px; margin: 20px auto;" onclick="app.openModal('loginModal')">Login</button>
                        </div>
                    `;
                    return;
                }
                
                content.innerHTML = '<div class="loading"><div class="spinner"></div></div>';
                
                try {
                    // Load all notification types
                    const [repliesRes, mentionsRes, messagesRes] = await Promise.all([
                        this.api.getReplies({ unread_only: false, limit: 20 }),
                        this.api.getMentions({ unread_only: false, limit: 20 }),
                        this.api.getPrivateMessages({ unread_only: false, limit: 20 })
                    ]);
                    
                    this.notifications.replies = repliesRes.replies || [];
                    this.notifications.mentions = mentionsRes.mentions || [];
                    this.notifications.messages = messagesRes.private_messages || [];
                    
                    this.renderInbox();
                } catch (error) {
                    this.showToast('Failed to load notifications');
                    content.innerHTML = `
                        <div class="empty-state">
                            <div class="empty-icon">‚ùå</div>
                            <div class="empty-title">Failed to load inbox</div>
                            <div class="empty-text">Please try again later</div>
                        </div>
                    `;
                }
            }

            renderInbox() {
                const content = document.getElementById('content');
                
                // Combine all notifications
                const allNotifications = [
                    ...this.notifications.replies.map(r => ({ type: 'reply', data: r })),
                    ...this.notifications.mentions.map(m => ({ type: 'mention', data: m })),
                    ...this.notifications.messages.map(m => ({ type: 'message', data: m }))
                ];
                
                // Sort by date
                allNotifications.sort((a, b) => {
                    const dateA = new Date(a.data.comment?.published || a.data.private_message?.published || 0);
                    const dateB = new Date(b.data.comment?.published || b.data.private_message?.published || 0);
                    return dateB - dateA;
                });
                
                if (allNotifications.length === 0) {
                    content.innerHTML = `
                        <div class="empty-state">
                            <div class="empty-icon">üì≠</div>
                            <div class="empty-title">Inbox Empty</div>
                            <div class="empty-text">No new notifications</div>
                        </div>
                    `;
                    return;
                }
                
                const notificationsHTML = allNotifications.map(notification => {
                    const { type, data } = notification;
                    
                    if (type === 'reply') {
                        const reply = data.comment;
                        const creator = data.creator;
                        const post = data.post;
                        
                        return `
                            <div class="notification-item ${!data.comment_reply.read ? 'unread' : ''}" 
                                 onclick="app.viewPost(${post.id})">
                                <div class="notification-header">
                                    <span class="notification-type">Reply</span>
                                    <span>u/${creator.name}</span>
                                    <span>‚Ä¢</span>
                                    <span>${this.formatTime(reply.published)}</span>
                                </div>
                                <div class="notification-content">
                                    ${this.parseMarkdown(reply.content.substring(0, 200))}
                                </div>
                                <div class="notification-meta">
                                    On post: ${this.escapeHtml(post.name)}
                                </div>
                            </div>
                        `;
                    } else if (type === 'mention') {
                        const mention = data.comment;
                        const creator = data.creator;
                        const post = data.post;
                        
                        return `
                            <div class="notification-item ${!data.person_mention.read ? 'unread' : ''}"
                                 onclick="app.viewPost(${post.id})">
                                <div class="notification-header">
                                    <span class="notification-type">Mention</span>
                                    <span>u/${creator.name}</span>
                                    <span>‚Ä¢</span>
                                    <span>${this.formatTime(mention.published)}</span>
                                </div>
                                <div class="notification-content">
                                    ${this.parseMarkdown(mention.content.substring(0, 200))}
                                </div>
                                <div class="notification-meta">
                                    On post: ${this.escapeHtml(post.name)}
                                </div>
                            </div>
                        `;
                    } else if (type === 'message') {
                        const message = data.private_message;
                        const creator = data.creator;
                        
                        return `
                            <div class="notification-item ${!message.read ? 'unread' : ''}">
                                <div class="notification-header">
                                    <span class="notification-type">Message</span>
                                    <span>u/${creator.name}</span>
                                    <span>‚Ä¢</span>
                                    <span>${this.formatTime(message.published)}</span>
                                </div>
                                <div class="notification-content">
                                    ${this.parseMarkdown(message.content.substring(0, 200))}
                                </div>
                            </div>
                        `;
                    }
                }).join('');
                
                content.innerHTML = `
                    <div style="padding: 16px; border-bottom: 1px solid var(--border);">
                        <h2 style="margin: 0;">Inbox</h2>
                        ${this.unreadCount > 0 ? `<button class="btn btn-secondary" style="margin-top: 12px;" onclick="app.markAllAsRead()">Mark All as Read</button>` : ''}
                    </div>
                    ${notificationsHTML}
                `;
            }

            async markAllAsRead() {
                if (!this.api.auth) return;
                
                try {
                    // Mark all replies as read
                    for (const reply of this.notifications.replies) {
                        if (!reply.comment_reply.read) {
                            await this.api.markReplyAsRead(reply.comment_reply.id, true);
                        }
                    }
                    
                    // Mark all mentions as read
                    for (const mention of this.notifications.mentions) {
                        if (!mention.person_mention.read) {
                            await this.api.markMentionAsRead(mention.person_mention.id, true);
                        }
                    }
                    
                    // Mark all messages as read
                    for (const message of this.notifications.messages) {
                        if (!message.private_message.read) {
                            await this.api.markPrivateMessageAsRead(message.private_message.id, true);
                        }
                    }
                    
                    this.showToast('All notifications marked as read');
                    this.unreadCount = 0;
                    this.updateNotificationBadges();
                    this.showInbox(); // Reload inbox
                } catch (error) {
                    this.showToast('Failed to mark as read');
                }
            }

            // Post Detail
            async viewPost(postId) {
                const content = document.getElementById('content');
                content.innerHTML = '<div class="loading"><div class="spinner"></div></div>';
                
                try {
                    const [postResponse, commentsResponse] = await Promise.all([
                        this.api.getPost(postId),
                        this.api.getComments({ post_id: postId })
                    ]);
                    
                    this.currentPost = postResponse.post_view;
                    this.renderPostDetail(postResponse.post_view, commentsResponse.comments);
                } catch (error) {
                    this.showToast('Failed to load post');
                }
            }

            renderPostDetail(postView, comments) {
                const post = postView.post;
                const creator = postView.creator;
                const community = postView.community;
                const counts = postView.counts;
                
                const bodyHTML = post.body ? this.parseMarkdown(post.body) : '';
                
                let imageHTML = '';
                if (post.url && post.url.match(/\.(jpg|jpeg|png|gif|webp)$/i)) {
                    imageHTML = `<img class="post-detail-image" src="${post.url}" alt="">`;
                }
                
                const content = document.getElementById('content');
                content.innerHTML = `
                    <div class="post-detail">
                        <div class="post-detail-content">
                            <div class="post-meta">
                                <div class="community-icon"></div>
                                <span>c/${community.name}</span>
                                <span>‚Ä¢</span>
                                <span>u/${creator.name}</span>
                                <span>‚Ä¢</span>
                                <span>${this.formatTime(post.published)}</span>
                            </div>
                            <h1 class="post-detail-title">${this.escapeHtml(post.name)}</h1>
                            ${imageHTML}
                            <div class="post-detail-body markdown">${bodyHTML}</div>
                            ${post.url && !post.url.match(/\.(jpg|jpeg|png|gif|webp)$/i) ? 
                                `<a href="${post.url}" target="_blank" class="post-link">üîó ${post.url}</a>` : ''}
                            <div class="post-actions">
                                <div class="vote-group">
                                    <button class="vote-btn ${postView.my_vote === 1 ? 'upvoted' : ''}" 
                                            onclick="app.votePost(${post.id}, ${postView.my_vote === 1 ? 0 : 1})">
                                        ‚ñ≤
                                    </button>
                                    <span class="vote-count">${this.formatCount(counts.score)}</span>
                                    <button class="vote-btn ${postView.my_vote === -1 ? 'downvoted' : ''}" 
                                            onclick="app.votePost(${post.id}, ${postView.my_vote === -1 ? 0 : -1})">
                                        ‚ñº
                                    </button>
                                </div>
                                <button class="post-action-btn" onclick="app.sharePost(${post.id})">
                                    üîó Share
                                </button>
                                <button class="post-action-btn" onclick="app.savePost(${post.id}, ${!postView.saved})">
                                    ${postView.saved ? 'üîñ' : 'üìë'} Save
                                </button>
                            </div>
                        </div>
                        
                        <div class="reply-box">
                            <textarea class="reply-textarea" id="postReplyText" placeholder="Write a comment..."></textarea>
                            <div class="reply-actions">
                                <button class="reply-btn" onclick="app.submitPostComment(${post.id})">Comment</button>
                            </div>
                        </div>
                        
                        <div class="comments-section">
                            <div class="comments-header">
                                <h3 class="comments-title">Comments (${counts.comments})</h3>
                            </div>
                            <div id="commentsContainer">
                                ${this.renderComments(comments)}
                            </div>
                        </div>
                    </div>
                `;
            }

            renderComments(comments, parentId = null, depth = 0) {
                if (depth > 4) return '';
                
                const filtered = comments.filter(c => {
                    const comment = c.comment;
                    if (parentId === null) {
                        return !comment.path.includes('.');
                    }
                    return comment.path.startsWith(parentId + '.') && 
                           comment.path.split('.').length === parentId.split('.').length + 1;
                });
                
                return filtered.map(commentView => {
                    const comment = commentView.comment;
                    const creator = commentView.creator;
                    const counts = commentView.counts;
                    
                    const childComments = this.renderComments(comments, comment.path, depth + 1);
                    
                    return `
                        <div class="comment depth-${depth}">
                            <div class="comment-header">
                                <span class="comment-author">u/${creator.name}</span>
                                <span>‚Ä¢</span>
                                <span>${this.formatTime(comment.published)}</span>
                            </div>
                            <div class="comment-body markdown">${this.parseMarkdown(comment.content)}</div>
                            <div class="comment-actions">
                                <div class="vote-group">
                                    <button class="vote-btn ${commentView.my_vote === 1 ? 'upvoted' : ''}" 
                                            onclick="app.voteComment(${comment.id}, ${commentView.my_vote === 1 ? 0 : 1})">
                                        ‚ñ≤
                                    </button>
                                    <span class="vote-count">${counts.score}</span>
                                    <button class="vote-btn ${commentView.my_vote === -1 ? 'downvoted' : ''}" 
                                            onclick="app.voteComment(${comment.id}, ${commentView.my_vote === -1 ? 0 : -1})">
                                        ‚ñº
                                    </button>
                                </div>
                                <button class="post-action-btn" onclick="app.showReplyBox(${comment.id}, ${comment.post_id})">
                                    ‚Ü©Ô∏è Reply
                                </button>
                            </div>
                            <div id="reply-box-${comment.id}"></div>
                            ${childComments}
                        </div>
                    `;
                }).join('');
            }

            // Actions
            async votePost(postId, score) {
                if (!this.api.auth) {
                    this.showToast('Please login to vote');
                    return;
                }
                
                try {
                    await this.api.likePost(postId, score);
                    this.showToast(score === 1 ? 'Upvoted' : score === -1 ? 'Downvoted' : 'Vote removed');
                    
                    // Update local state
                    const post = this.posts.find(p => p.post.id === postId);
                    if (post) {
                        if (post.my_vote === score) {
                            post.my_vote = 0;
                        } else {
                            post.my_vote = score;
                        }
                        this.renderPosts();
                    }
                } catch (error) {
                    this.showToast('Failed to vote');
                }
            }

            async voteComment(commentId, score) {
                if (!this.api.auth) {
                    this.showToast('Please login to vote');
                    return;
                }
                
                try {
                    await this.api.likeComment(commentId, score);
                    this.showToast(score === 1 ? 'Upvoted' : score === -1 ? 'Downvoted' : 'Vote removed');
                } catch (error) {
                    this.showToast('Failed to vote');
                }
            }

            async savePost(postId, save) {
                if (!this.api.auth) {
                    this.showToast('Please login to save');
                    return;
                }
                
                try {
                    await this.api.savePost(postId, save);
                    this.showToast(save ? 'Post saved' : 'Post unsaved');
                    
                    // Update local state
                    const post = this.posts.find(p => p.post.id === postId);
                    if (post) {
                        post.saved = save;
                        this.renderPosts();
                    }
                } catch (error) {
                    this.showToast('Failed to save post');
                }
            }

            sharePost(postId) {
                const post = this.posts.find(p => p.post.id === postId) || this.currentPost;
                if (post) {
                    const url = `${window.location.origin}/#/post/${postId}`;
                    if (navigator.share) {
                        navigator.share({
                            title: post.post.name,
                            url: url
                        });
                    } else {
                        navigator.clipboard.writeText(url);
                        this.showToast('Link copied to clipboard');
                    }
                }
            }

            // Comments
            async submitPostComment(postId) {
                if (!this.api.auth) {
                    this.showToast('Please login to comment');
                    return;
                }
                
                const textarea = document.getElementById('postReplyText');
                const content = textarea.value.trim();
                
                if (!content) {
                    this.showToast('Please enter a comment');
                    return;
                }
                
                try {
                    await this.api.createComment({
                        post_id: postId,
                        content: content
                    });
                    
                    textarea.value = '';
                    this.showToast('Comment posted!');
                    
                    // Reload comments
                    const response = await this.api.getComments({ post_id: postId });
                    document.getElementById('commentsContainer').innerHTML = this.renderComments(response.comments);
                } catch (error) {
                    this.showToast('Failed to post comment');
                }
            }

            showReplyBox(commentId, postId) {
                if (!this.api.auth) {
                    this.showToast('Please login to reply');
                    return;
                }
                
                const replyBox = document.getElementById(`reply-box-${commentId}`);
                if (replyBox.innerHTML) {
                    replyBox.innerHTML = '';
                    return;
                }
                
                replyBox.innerHTML = `
                    <div class="reply-box" style="margin: 8px 0;">
                        <textarea class="reply-textarea" id="reply-text-${commentId}" placeholder="Write a reply..."></textarea>
                        <div class="reply-actions">
                            <button class="reply-btn" onclick="app.submitCommentReply(${commentId}, ${postId})">Reply</button>
                            <button class="cancel-btn" onclick="app.cancelReply(${commentId})">Cancel</button>
                        </div>
                    </div>
                `;
                
                document.getElementById(`reply-text-${commentId}`).focus();
            }

            async submitCommentReply(parentId, postId) {
                const textarea = document.getElementById(`reply-text-${parentId}`);
                const content = textarea.value.trim();
                
                if (!content) {
                    this.showToast('Please enter a reply');
                    return;
                }
                
                try {
                    await this.api.createComment({
                        post_id: postId,
                        parent_id: parentId,
                        content: content
                    });
                    
                    this.showToast('Reply posted!');
                    this.cancelReply(parentId);
                    
                    // Reload comments
                    const response = await this.api.getComments({ post_id: postId });
                    document.getElementById('commentsContainer').innerHTML = this.renderComments(response.comments);
                } catch (error) {
                    this.showToast('Failed to post reply');
                }
            }

            cancelReply(commentId) {
                document.getElementById(`reply-box-${commentId}`).innerHTML = '';
            }

            // Communities
            async loadCommunities() {
                const content = document.getElementById('content');
                content.innerHTML = '<div class="loading"><div class="spinner"></div></div>';
                
                try {
                    const response = await this.api.getCommunities({
                        type_: 'Local',
                        sort: 'TopAll',
                        limit: 50
                    });
                    
                    this.communities = response.communities || [];
                    this.renderCommunities();
                } catch (error) {
                    this.showToast('Failed to load communities');
                }
            }

            renderCommunities() {
                const content = document.getElementById('content');
                
                if (this.communities.length === 0) {
                    content.innerHTML = `
                        <div class="empty-state">
                            <div class="empty-icon">üë•</div>
                            <div class="empty-title">No communities found</div>
                        </div>
                    `;
                    return;
                }
                
                const communitiesHTML = this.communities.map(communityView => {
                    const community = communityView.community;
                    const counts = communityView.counts;
                    
                    return `
                        <div class="post" onclick="app.viewCommunity(${community.id})">
                            <div class="post-content">
                                <div style="display: flex; align-items: center; gap: 12px;">
                                    <div class="community-icon" style="width: 40px; height: 40px;"></div>
                                    <div style="flex: 1;">
                                        <h3 style="margin: 0; font-size: 16px;">c/${community.name}</h3>
                                        <p style="margin: 4px 0; font-size: 13px; color: var(--text-secondary);">
                                            ${this.formatCount(counts.subscribers)} subscribers ‚Ä¢ ${this.formatCount(counts.posts)} posts
                                        </p>
                                    </div>
                                    <button class="btn" style="width: auto; padding: 8px 16px; font-size: 13px;"
                                            onclick="event.stopPropagation(); app.followCommunity(${community.id}, ${!communityView.subscribed})">
                                        ${communityView.subscribed ? 'Unfollow' : 'Follow'}
                                    </button>
                                </div>
                                ${community.description ? `<p style="margin-top: 12px; font-size: 14px; color: var(--text-secondary);">${this.escapeHtml(community.description)}</p>` : ''}
                            </div>
                        </div>
                    `;
                }).join('');
                
                content.innerHTML = communitiesHTML;
            }

            async viewCommunity(communityId) {
                this.showToast('Loading community...');
                // Implementation for viewing specific community
            }

            async followCommunity(communityId, follow) {
                if (!this.api.auth) {
                    this.showToast('Please login to follow communities');
                    return;
                }
                
                try {
                    await this.api.followCommunity(communityId, follow);
                    this.showToast(follow ? 'Community followed' : 'Community unfollowed');
                    this.loadCommunities();
                    
                    // Reload subscribed communities
                    await this.loadSubscribedCommunities();
                } catch (error) {
                    this.showToast('Failed to update follow status');
                }
            }

            // Create Post
            async showCreatePost() {
                if (!this.api.auth) {
                    this.showToast('Please login to create posts');
                    return;
                }
                
                // Load communities for dropdown
                try {
                    // Prioritize subscribed communities
                    let communities = [];
                    
                    if (this.subscribedCommunities.length > 0) {
                        communities = this.subscribedCommunities;
                    } else {
                        const response = await this.api.getCommunities({ limit: 100 });
                        communities = response.communities || [];
                    }
                    
                    const select = document.getElementById('postCommunity');
                    select.innerHTML = '<option value="">Select a community</option>' +
                        communities.map(c => 
                            `<option value="${c.community.id}">c/${c.community.name}</option>`
                        ).join('');
                } catch (error) {
                    console.error('Failed to load communities');
                }
                
                this.openModal('createPostModal');
            }

            async createPost() {
                const community_id = parseInt(document.getElementById('postCommunity').value);
                const name = document.getElementById('postTitle').value.trim();
                const url = document.getElementById('postUrl').value.trim();
                const body = document.getElementById('postBody').value.trim();
                
                if (!community_id || !name) {
                    this.showToast('Please select a community and enter a title');
                    return;
                }
                
                try {
                    await this.api.createPost({
                        community_id,
                        name,
                        url: url || undefined,
                        body: body || undefined
                    });
                    
                    this.closeModal('createPostModal');
                    this.showToast('Post created successfully!');
                    
                    // Clear form
                    document.getElementById('postTitle').value = '';
                    document.getElementById('postUrl').value = '';
                    document.getElementById('postBody').value = '';
                    
                    // Reload posts
                    this.currentPage = 1;
                    this.posts = [];
                    this.loadPosts();
                } catch (error) {
                    this.showToast('Failed to create post');
                }
            }

            // Auth
            async login() {
                const instance = document.getElementById('instanceInput').value.trim();
                const username = document.getElementById('usernameInput').value.trim();
                const password = document.getElementById('passwordInput').value;
                
                if (!instance || !username || !password) {
                    this.showToast('Please fill in all fields');
                    return;
                }
                
                try {
                    // Update instance
                    this.api.baseUrl = `https://${instance}`;
                    
                    // Login
                    const response = await this.api.login(username, password);
                    
                    if (response.jwt) {
                        // Save credentials
                        localStorage.setItem('lemmy_instance', this.api.baseUrl);
                        localStorage.setItem('lemmy_user', JSON.stringify({
                            username: username,
                            instance: instance
                        }));
                        
                        this.currentUser = { username, instance };
                        this.updateUserUI();
                        
                        // Load subscribed communities
                        await this.loadSubscribedCommunities();
                        
                        // Start notification polling
                        this.startNotificationPolling();
                        
                        this.closeModal('loginModal');
                        this.showToast('Logged in successfully!');
                        
                        // Reload posts
                        this.currentPage = 1;
                        this.posts = [];
                        this.loadPosts();
                    } else {
                        this.showToast('Login failed');
                    }
                } catch (error) {
                    this.showToast('Login failed. Check your credentials.');
                }
            }

            logout() {
                this.api.auth = null;
                this.currentUser = null;
                this.subscribedCommunities = [];
                this.unreadCount = 0;
                
                // Clear notification polling
                if (this.notificationInterval) {
                    clearInterval(this.notificationInterval);
                    this.notificationInterval = null;
                }
                
                localStorage.removeItem('lemmy_jwt');
                localStorage.removeItem('lemmy_user');
                
                this.updateUserUI();
                this.updateNotificationBadges();
                this.showToast('Logged out');
                
                // Switch to Local feed if on Subscribed
                if (this.currentFeed === 'Subscribed') {
                    this.switchFeed('Local');
                } else {
                    // Reload posts
                    this.currentPage = 1;
                    this.posts = [];
                    this.loadPosts();
                }
            }

            handleAuth() {
                if (this.api.auth) {
                    if (confirm('Are you sure you want to logout?')) {
                        this.logout();
                    }
                } else {
                    this.openModal('loginModal');
                }
            }

            updateUserUI() {
                const userAvatar = document.getElementById('userAvatar');
                const drawerAvatar = document.getElementById('drawerAvatar');
                const drawerUsername = document.getElementById('drawerUsername');
                const drawerInstance = document.getElementById('drawerInstance');
                const authBtn = document.getElementById('authBtn');
                
                if (this.currentUser) {
                    const initial = this.currentUser.username[0].toUpperCase();
                    userAvatar.textContent = initial;
                    drawerAvatar.textContent = initial;
                    drawerUsername.textContent = `u/${this.currentUser.username}`;
                    drawerInstance.textContent = `@${this.currentUser.instance}`;
                    authBtn.innerHTML = '<span class="drawer-icon">üö™</span><span>Logout</span>';
                } else {
                    userAvatar.textContent = '?';
                    drawerAvatar.textContent = '?';
                    drawerUsername.textContent = 'Guest';
                    drawerInstance.textContent = 'Not logged in';
                    authBtn.innerHTML = '<span class="drawer-icon">üîë</span><span>Login</span>';
                }
            }

            // Other Views
            showSearch() {
                const content = document.getElementById('content');
                content.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">üîç</div>
                        <div class="empty-title">Search</div>
                        <div class="empty-text">Search functionality coming soon</div>
                    </div>
                `;
            }

            showProfile() {
                const content = document.getElementById('content');
                
                if (this.currentUser) {
                    content.innerHTML = `
                        <div style="padding: 20px;">
                            <div style="display: flex; align-items: center; gap: 16px; margin-bottom: 24px;">
                                <div class="user-avatar" style="width: 64px; height: 64px; font-size: 24px;">
                                    ${this.currentUser.username[0].toUpperCase()}
                                </div>
                                <div>
                                    <h2 style="margin: 0;">u/${this.currentUser.username}</h2>
                                    <p style="margin: 4px 0; color: var(--text-secondary);">@${this.currentUser.instance}</p>
                                </div>
                            </div>
                            <button class="btn btn-secondary" onclick="app.logout()">Logout</button>
                        </div>
                    `;
                } else {
                    content.innerHTML = `
                        <div class="empty-state">
                            <div class="empty-icon">üë§</div>
                            <div class="empty-title">Not Logged In</div>
                            <div class="empty-text">Login to view your profile</div>
                            <button class="btn" style="max-width: 200px; margin: 20px auto;" onclick="app.openModal('loginModal')">Login</button>
                        </div>
                    `;
                }
            }

            showSaved() {
                const content = document.getElementById('content');
                content.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">üîñ</div>
                        <div class="empty-title">Saved Posts</div>
                        <div class="empty-text">Your saved posts will appear here</div>
                    </div>
                `;
            }

            showSettings() {
                const content = document.getElementById('content');
                content.innerHTML = `
                    <div style="padding: 20px;">
                        <h2 style="margin-bottom: 20px;">Settings</h2>
                        <div style="margin-bottom: 20px;">
                            <button class="btn btn-secondary" onclick="app.toggleTheme()">Toggle Theme</button>
                        </div>
                        <div style="margin-bottom: 20px;">
                            <button class="btn btn-secondary" onclick="app.showInstanceModal()">Change Instance</button>
                        </div>
                    </div>
                `;
            }

            showInstanceModal() {
                this.showToast('Instance picker coming soon');
            }

            showRegisterModal() {
                this.showToast('Registration coming soon');
            }

            // UI Utilities
            toggleDrawer() {
                const drawer = document.getElementById('drawer');
                const overlay = document.getElementById('drawerOverlay');
                drawer.classList.toggle('active');
                overlay.classList.toggle('active');
            }

            toggleUserMenu() {
                this.toggleDrawer();
            }

            toggleTheme() {
                const isDark = document.body.dataset.theme === 'dark';
                document.body.dataset.theme = isDark ? '' : 'dark';
                localStorage.setItem('theme', isDark ? 'light' : 'dark');
                this.showToast(`Switched to ${isDark ? 'light' : 'dark'} mode`);
            }

            openModal(modalId) {
                document.getElementById(modalId).classList.add('active');
            }

            closeModal(modalId) {
                document.getElementById(modalId).classList.remove('active');
            }

            showToast(message) {
                const toast = document.getElementById('toast');
                toast.textContent = message;
                toast.classList.add('show');
                setTimeout(() => toast.classList.remove('show'), 3000);
            }

            // Utilities
            parseMarkdown(text) {
                if (!text) return '';
                
                let html = this.escapeHtml(text);
                
                // Images
                html = html.replace(/!\[([^\]]*)\]\(([^)]+)\)/g, '<img src="$2" alt="$1" style="max-width: 100%; height: auto;">');
                
                // Links
                html = html.replace(/\[([^\]]+)\]\(([^)]+)\)/g, '<a href="$2" target="_blank" rel="noopener">$1</a>');
                
                // Bold
                html = html.replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>');
                
                // Italic
                html = html.replace(/\*(.+?)\*/g, '<em>$1</em>');
                
                // Headers
                html = html.replace(/^### (.+)$/gm, '<h3>$1</h3>');
                html = html.replace(/^## (.+)$/gm, '<h2>$1</h2>');
                html = html.replace(/^# (.+)$/gm, '<h1>$1</h1>');
                
                // Line breaks
                html = html.replace(/\n/g, '<br>');
                
                return html;
            }

            escapeHtml(text) {
                const map = {
                    '&': '&amp;',
                    '<': '&lt;',
                    '>': '&gt;',
                    '"': '&quot;',
                    "'": '&#39;'
                };
                return text.replace(/[&<>"']/g, m => map[m]);
            }

            formatTime(timestamp) {
                const date = new Date(timestamp);
                const now = new Date();
                const diff = now - date;
                const seconds = Math.floor(diff / 1000);
                const minutes = Math.floor(seconds / 60);
                const hours = Math.floor(minutes / 60);
                const days = Math.floor(hours / 24);
                
                if (days > 0) return `${days}d`;
                if (hours > 0) return `${hours}h`;
                if (minutes > 0) return `${minutes}m`;
                return 'now';
            }

            formatCount(count) {
                if (count >= 1000000) return `${(count / 1000000).toFixed(1)}M`;
                if (count >= 1000) return `${(count / 1000).toFixed(1)}k`;
                return count.toString();
            }
        }

        // Initialize app
        const app = new LemmyApp();
    </script>
</body>
</html>
