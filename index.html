<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="icon.png">
    <title>The Shed</title>
  <link rel="stylesheet" href="style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/9.1.6/marked.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/dompurify/3.0.7/purify.min.js"></script>

</head>
<body>
    <!-- Top Navigation Bar -->
    <div class="top-nav">
        <!-- Feed Tabs (centered, only show when on feed page and user is logged in) -->
        <div id="feedTabs" class="feed-tabs">
            <button class="feed-tab active" id="generalTab" onclick="switchFeedTab('general')">
                General
            </button>
            <button class="feed-tab" id="followedTab" onclick="switchFeedTab('followed')">
                Followed
            </button>
            <button class="feed-tab" id="privateTab" onclick="switchFeedTab('private')">
                Private
            </button>
        </div>
    </div>

    <!-- Menu Overlay -->
    <div class="menu-overlay" id="menuOverlay" onclick="toggleMenu()"></div>

    <!-- Sliding Menu -->
    <div class="slide-menu" id="slideMenu">
        <div class="menu-header" id="menuHeader">
            <!-- User info will be inserted here -->
        </div>
        
        <nav class="menu-nav">
            <button class="menu-item active" id="menuFeed" onclick="navigateToFeed()">
                <span class="menu-item-icon">üè†</span>
                <span>Feed</span>
            </button>
            
            <button class="menu-item" id="menuProfile" onclick="navigateToProfile()">
                <span class="menu-item-icon">üë§</span>
                <span>Profile</span>
            </button>
            
            <button class="menu-item" id="menuCreateCommunity" onclick="openCreate()">
                <span class="menu-item-icon">‚ûï</span>
                <span>Create Shed</span>
            </button>
            
            <button class="menu-item" id="menuBrowseCommunities" onclick="toggleCommunitiesDropdown()">
                <span class="menu-item-icon">üèòÔ∏è</span>
                <span>Browse Sheds</span>
                <span style="margin-left: auto; font-size: 12px;" id="communitiesToggle">‚ñº</span>
            </button>
            
            <div class="communities-dropdown" id="communitiesDropdown">
                <!-- Communities will be inserted here -->
            </div>
            
            <div class="menu-divider"></div>
            
            <button class="menu-item" id="menuAdmin" onclick="navigateToAdmin()" style="display: none;">
                <span class="menu-item-icon">üîß</span>
                <span>Admin Panel</span>
            </button>
            
            <button class="menu-item" id="menuSettings" onclick="navigateToSettings()">
                <span class="menu-item-icon">‚öôÔ∏è</span>
                <span>Settings</span>
            </button>
            
            <button class="menu-item" id="menuLogout" onclick="logout()">
                <span class="menu-item-icon">üö™</span>
                <span>Logout</span>
            </button>
        </nav>
    </div>

    <!-- Floating Menu Toggle -->
    <button class="menu-toggle" id="menuToggle" onclick="toggleMenu()">
        <span>‚ò∞</span>
    </button>

    <!-- Admin Panel -->
    <div id="adminPanel" class="admin-panel" style="display: none;">
        <div class="admin-panel-header">
            <span>üîß Admin Panel</span>
        </div>
        
        <div class="admin-stats" id="adminStats">
            <div class="admin-stat-card">
                <div class="admin-stat-number" id="totalUsers">0</div>
                <div class="admin-stat-label">Total Users</div>
            </div>
            <div class="admin-stat-card">
                <div class="admin-stat-number" id="pendingUsers">0</div>
                <div class="admin-stat-label">Pending Users</div>
            </div>
            <div class="admin-stat-card">
                <div class="admin-stat-number" id="totalPosts">0</div>
                <div class="admin-stat-label">Total Posts</div>
            </div>
            <div class="admin-stat-card">
                <div class="admin-stat-number" id="totalCommunities">0</div>
                <div class="admin-stat-label">Communities</div>
            </div>
        </div>

        <div style="display: flex; gap: 8px; flex-wrap: wrap; margin-bottom: 16px;">
            <button class="btn btn-danger btn-small" onclick="loadPendingUsers()">Pending Users</button>
            <button class="btn btn-danger btn-small" onclick="loadAllUsers()">All Users</button>
            <button class="btn btn-danger btn-small" onclick="loadAdminCommunities()">Manage Communities</button>
            <button class="btn btn-danger btn-small" onclick="refreshAdminStats()">Refresh Stats</button>
        </div>

        <!-- Admin sections will be inserted here -->
        <div id="pendingUsersSection" class="admin-section" style="display: none;">
            <h4 style="color: var(--danger-fg); margin-bottom: 12px;">Pending User Approvals</h4>
            <div id="pendingUsersList"></div>
        </div>

        <div id="allUsersSection" class="admin-section" style="display: none;">
            <h4 style="color: var(--danger-fg); margin-bottom: 12px;">All Users</h4>
            <div id="allUsersList"></div>
        </div>

        <div id="adminCommunitiesSection" class="admin-section" style="display: none;">
            <h4 style="color: var(--danger-fg); margin-bottom: 12px;">Community Management</h4>
            <div id="adminCommunitiesList"></div>
        </div>
    </div>

    <!-- Main Content -->
    <main class="main-container">
        <!-- Feed Content -->
        <div id="feed">
            <div class="loading">Loading...</div>
        </div>
    </main>

    <button class="compose-btn" id="composeBtn" style="display: none;" onclick="openModal('composeModal')">+</button>

    <!-- Modals (keeping the existing modal structure but with updated styling) -->
    <!-- Auth Modal -->
    <div class="modal" id="authModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="authTitle">Sign Up</h3>
                <button class="close-btn" onclick="closeModal('authModal')">&times;</button>
            </div>
            <div id="authError"></div>
            <form id="authForm">
                <div class="form-group">
                    <label for="username">Username</label>
                    <input type="text" id="username" required minlength="3" maxlength="20">
                </div>
                <div class="form-group">
                    <label for="password">Password</label>
                    <input type="password" id="password" required minlength="6">
                </div>
                <div class="form-group">
                    <label for="bio">Bio (Optional)</label>
                    <textarea id="bio" placeholder="Tell us about yourself..." maxlength="500"></textarea>
                </div>
                <button type="submit" class="btn" id="authSubmitBtn">Sign Up</button>
            </form>
            <p style="margin-top: 16px; color: var(--fg-muted); font-size: 14px;">
                <span id="authToggleText">Already have an account?</span>
                <button type="button" class="btn-secondary btn" id="authToggleBtn" onclick="toggleAuthMode()">Sign In</button>
            </p>
        </div>
    </div>

    <!-- Create Community Modal -->
    <div class="modal" id="createCommunityModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Build Shed</h3>
                <button class="close-btn" onclick="closeModal('createCommunityModal')">&times;</button>
            </div>
            <div id="createCommunityError"></div>
            <form id="createCommunityForm">
                <div class="form-group">
                    <label for="communityName">Shed Name</label>
                    <input type="text" id="communityName" required minlength="3" maxlength="25" pattern="[a-z0-9_]+" placeholder="programming">
                    <small>3-25 characters, lowercase, letters, numbers, and underscores only</small>
                </div>
                <div class="form-group">
                    <label for="communityDisplayName">Display Name</label>
                    <input type="text" id="communityDisplayName" required maxlength="50" placeholder="Programming">
                </div>
                <div class="form-group">
                    <label for="communityDescription">Description</label>
                    <textarea id="communityDescription" maxlength="500" placeholder="A community for programming discussions and help"></textarea>
                </div>
                <button type="submit" class="btn" id="createCommunitySubmitBtn">Build Shed</button>
            </form>
        </div>
    </div>

    <!-- Image Insert Modal -->
    <div class="modal" id="imageInsertModal">
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header">
                <h3>Insert Image</h3>
                <button class="close-btn" onclick="closeModal('imageInsertModal')">&times;</button>
            </div>
            <form id="imageInsertForm" onsubmit="handleImageInsert(event)">
                <div class="form-group">
                    <label for="imageUrl">Image URL</label>
                    <input type="url" id="imageUrl" placeholder="https://example.com/image.jpg" required>
                    <small>Enter a direct link to an image (jpg, png, gif, webp)</small>
                </div>
                <div class="form-group">
                    <label for="imageAltText">Alt Text (Optional)</label>
                    <input type="text" id="imageAltText" placeholder="Description of the image" maxlength="200">
                    <small>Describes the image for accessibility and if the image fails to load</small>
                </div>
                <div class="form-group">
                    <label for="imageTitle">Title (Optional)</label>
                    <input type="text" id="imageTitle" placeholder="Image title" maxlength="200">
                    <small>Shows as a tooltip when hovering over the image</small>
                </div>
                <button type="submit" class="btn">Insert Image</button>
            </form>
        </div>
    </div>

    <!-- Link Insert Modal -->
    <div class="modal" id="linkInsertModal">
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header">
                <h3>Insert Link</h3>
                <button class="close-btn" onclick="closeModal('linkInsertModal')">&times;</button>
            </div>
            <form id="linkInsertForm" onsubmit="handleLinkInsert(event)">
                <div class="form-group">
                    <label for="linkUrl">URL</label>
                    <input type="url" id="linkUrl" placeholder="https://example.com" required>
                    <small>The web address you want to link to</small>
                </div>
                <div class="form-group">
                    <label for="linkText">Link Text</label>
                    <input type="text" id="linkText" placeholder="Click here" maxlength="200" required>
                    <small>The text that will be clickable</small>
                </div>
                <button type="submit" class="btn">Insert Link</button>
            </form>
        </div>
    </div>
    <div class="modal" id="editProfileModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Edit Profile</h3>
                <button class="close-btn" onclick="closeModal('editProfileModal')">&times;</button>
            </div>
            <div id="editProfileError"></div>
            <form id="editProfileForm" onsubmit="handleUpdateProfile(event)">
                <div class="form-group">
                    <label for="editProfilePicture">Profile Picture URL</label>
                    <input type="url" id="editProfilePicture" placeholder="https://example.com/your-picture.jpg">
                    <small>Enter a URL to an image you'd like to use as your profile picture</small>
                </div>
                <div class="form-group">
                    <label for="editProfileBio">Bio</label>
                    <textarea id="editProfileBio" placeholder="Tell people about yourself..." maxlength="500"></textarea>
                    <small>Describe yourself in 500 characters or less</small>
                </div>
                <div class="form-group">
                    <small style="color: var(--fg-subtle);">
                        <strong>Tip:</strong> For profile pictures, you can use image hosting services like Imgur, or link directly to images from social media profiles.
                    </small>
                </div>
                <button type="submit" class="btn" id="editProfileSubmitBtn">Update Profile</button>
            </form>
        </div>
    </div>
    <div class="modal" id="composeModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Create Post</h3>
                <button class="close-btn" onclick="closeModal('composeModal')">&times;</button>
            </div>
            <div id="composeError"></div>
            <form id="composeForm">
                <div class="form-group">
                    <label for="postCommunity">Community (Optional)</label>
                    <select id="postCommunity">
                        <option value="">General Feed</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>Post Type</label>
                    <div style="display: flex; background: var(--bg-subtle); border-radius: 8px; overflow: hidden; margin-bottom: 16px;">
                        <button type="button" style="flex: 1; background: var(--btn-primary-bg); color: white; border: none; padding: 8px 16px; cursor: pointer; font-size: 14px;" onclick="setPostType('text')">Text Post</button>
                        <button type="button" style="flex: 1; background: transparent; color: var(--fg-default); border: none; padding: 8px 16px; cursor: pointer; font-size: 14px;" onclick="setPostType('link')">Link/Media</button>
                    </div>
                </div>

                <div class="form-group">
                    <label for="postTitle">Title</label>
                    <input type="text" id="postTitle" required maxlength="200">
                </div>

                <!-- Text Post Fields -->
                <div id="textPostFields">
                    <div class="form-group">
                        <label for="postContent">Content</label>
                        
                        <!-- Markdown Toolbar -->
                        <div class="markdown-toolbar">
                            <button type="button" class="markdown-btn" onclick="insertMarkdown('**', '**', 'Bold text')" title="Bold">
                                <strong>B</strong>
                            </button>
                            <button type="button" class="markdown-btn" onclick="insertMarkdown('*', '*', 'Italic text')" title="Italic">
                                <em>I</em>
                            </button>
                            <button type="button" class="markdown-btn" onclick="insertMarkdown('`', '`', 'Code')" title="Inline Code">
                                <code>&lt;/&gt;</code>
                            </button>
                            <button type="button" class="markdown-btn" onclick="insertMarkdown('```\n', '\n```', 'Code block')" title="Code Block">
                                <span>{ }</span>
                            </button>
                            <div class="toolbar-divider"></div>
                            <button type="button" class="markdown-btn" onclick="insertMarkdown('# ', '', 'Heading 1')" title="Heading 1">
                                H1
                            </button>
                            <button type="button" class="markdown-btn" onclick="insertMarkdown('## ', '', 'Heading 2')" title="Heading 2">
                                H2
                            </button>
                            <button type="button" class="markdown-btn" onclick="insertMarkdown('### ', '', 'Heading 3')" title="Heading 3">
                                H3
                            </button>
                            <div class="toolbar-divider"></div>
                            <button type="button" class="markdown-btn" onclick="insertMarkdown('> ', '', 'Quote text')" title="Quote">
                                <span>"</span>
                            </button>
                            <button type="button" class="markdown-btn" onclick="insertMarkdown('- ', '', 'List item')" title="Bullet List">
                                ‚Ä¢
                            </button>
                            <button type="button" class="markdown-btn" onclick="insertMarkdown('1. ', '', 'List item')" title="Numbered List">
                                1.
                            </button>
                            <div class="toolbar-divider"></div>
                            <button type="button" class="markdown-btn" onclick="insertLink()" title="Add Link">
                                üîó
                            </button>
                            <button type="button" class="markdown-btn" onclick="insertImage()" title="Add Image">
                                üñºÔ∏è
                            </button>
                            <button type="button" class="markdown-btn" onclick="insertMarkdown('~~', '~~', 'Strikethrough text')" title="Strikethrough">
                                <s>S</s>
                            </button>
                            <div class="toolbar-divider"></div>
                            <button type="button" class="markdown-btn" onclick="previewMarkdown()" title="Preview" id="previewBtn">
                                üëÅÔ∏è
                            </button>
                        </div>
                        
                        <textarea id="postContent" required placeholder="Share your thoughts... (Markdown supported)" maxlength="10000"></textarea>
                        
                        <!-- Preview Area -->
                        <div id="markdownPreview" class="markdown-preview" style="display: none;">
                            <div class="preview-header">
                                <span>Preview:</span>
                                <button type="button" class="btn-small" onclick="hidePreview()">Edit</button>
                            </div>
                            <div id="previewContent" class="markdown-content"></div>
                        </div>
                        
                        <small>Supports Markdown formatting. Use the toolbar buttons above for quick formatting!</small>
                    </div>
                </div>

                <!-- Link Post Fields -->
                <div id="linkPostFields" style="display: none;">
                    <div class="form-group">
                        <label for="postUrl">URL</label>
                        <input type="url" id="postUrl" placeholder="https://example.com">
                        <small>YouTube, Dailymotion, Suno, images, videos, audio, and other media will be embedded automatically</small>
                        
                        <!-- Media Preview Container -->
                        <div id="mediaPreview" style="margin-top: 12px; display: none;"></div>
                    </div>
                    
                    <div class="form-group">
                        <label for="postDescription">Description (Optional)</label>
                        <textarea id="postDescription" placeholder="Describe this link..." maxlength="2000"></textarea>
                    </div>
                </div>

                <div class="form-group">
                    <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                        <input type="checkbox" id="isPrivate" style="width: auto;">
                        <span>Private post (only you can see this)</span>
                    </label>
                </div>
                <button type="submit" class="btn" id="composeSubmitBtn">Post</button>
            </form>
        </div>
    </div>

      <script src="app.js"></script>
</body>
</html>
