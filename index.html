<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Shed - Community Forum</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css">
</head>
<body>
    <!-- Menu Toggle Button -->
    <button class="menu-toggle" id="menuToggle" onclick="toggleMenu()">‚ò∞</button>

    <!-- Top Navigation Bar -->
    <div class="top-nav">
        <div class="top-nav-spacer"></div>
        
        <!-- Feed Tabs (only visible when on feed page and logged in) -->
        <div class="feed-tabs" id="feedTabs">
            <button class="feed-tab active" id="generalTab" onclick="switchFeedTab('general')">General</button>
            <button class="feed-tab" id="followedTab" onclick="switchFeedTab('followed')" disabled>Followed</button>
        </div>
    </div>

    <!-- Sliding Menu -->
    <div class="slide-menu" id="slideMenu">
        <div class="menu-header" id="menuHeader">
            <!-- User info or login prompt will be inserted here by JS -->
        </div>
        
        <nav class="menu-nav">
            <a href="#" class="menu-item active" id="menuFeed" onclick="navigateToFeed()">
                <span class="menu-item-icon">üè†</span>
                <span>Feed</span>
            </a>
            
            <a href="#" class="menu-item" id="menuMyShed" onclick="navigateToMyShed()">
                <span class="menu-item-icon">üè†</span>
                <span>My Shed</span>
            </a>
            
            <a href="#" class="menu-item" id="menuProfile" onclick="navigateToProfile()" style="display: none;">
                <span class="menu-item-icon">üë§</span>
                <span>Profile</span>
            </a>
            
            <div class="menu-divider"></div>
            
            <a href="#" class="menu-item" id="menuBrowseCommunities" onclick="toggleCommunitiesDropdown()" style="display: none;">
                <span class="menu-item-icon">üèòÔ∏è</span>
                <span>Communities</span>
                <span id="communitiesToggle" style="margin-left: auto;">‚ñº</span>
            </a>
            
            <div class="communities-dropdown" id="communitiesDropdown">
                <!-- Communities will be loaded here -->
            </div>
            
            <a href="#" class="menu-item" id="menuCreateCommunity" onclick="openCreateCommunity()" style="display: none;">
                <span class="menu-item-icon">‚ûï</span>
                <span>Create Community</span>
            </a>
            
            <div class="menu-divider"></div>
            
            <a href="#" class="menu-item" id="menuAdmin" onclick="navigateToAdmin()" style="display: none;">
                <span class="menu-item-icon">üõ°Ô∏è</span>
                <span>Admin</span>
            </a>
            
            <a href="#" class="menu-item" id="menuSettings" onclick="navigateToSettings()" style="display: none;">
                <span class="menu-item-icon">‚öôÔ∏è</span>
                <span>Settings</span>
            </a>
            
            <div class="menu-divider"></div>
            
            <a href="#" class="menu-item" id="menuLogout" onclick="handleLogout()" style="display: none;">
                <span class="menu-item-icon">üö™</span>
                <span>Logout</span>
            </a>
        </nav>
    </div>

    <!-- Menu Overlay -->
    <div class="menu-overlay" id="menuOverlay" onclick="toggleMenu()"></div>

    <!-- Main Container -->
    <div class="main-container">
        <div id="feed" class="tab-content active">
            <!-- Dynamic content will be loaded here -->
        </div>
    </div>

    <!-- Compose Button -->
    <button class="compose-btn" id="composeBtn" onclick="openModal('composeModal')" style="display: none;">
        ‚úèÔ∏è
    </button>

    <!-- Authentication Modal -->
    <div class="modal" id="authModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="authTitle">Sign In</h3>
                <button class="close-btn" onclick="closeModal('authModal')">&times;</button>
            </div>
            <div id="authError"></div>
            <form id="authForm" data-mode="signin">
                <div class="form-group">
                    <label for="username">Username</label>
                    <input type="text" id="username" required minlength="3" maxlength="20">
                </div>
                <div class="form-group">
                    <label for="password">Password</label>
                    <input type="password" id="password" required minlength="9">
                </div>
                <div class="form-group" id="bioGroup" style="display: none;">
                    <label for="bio">Bio (Optional)</label>
                    <textarea id="bio" maxlength="500" placeholder="Tell us about yourself..."></textarea>
                </div>
                <div class="form-group" id="emailGroup" style="display: none;">
                    <label for="email">Email (Optional)</label>
                    <input type="email" id="email" placeholder="your@email.com">
                </div>
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="rememberMe"> Remember me
                    </label>
                </div>
                <div style="text-align: center; margin: 20px 0;">
                    <button type="submit" class="btn" id="authSubmitBtn">Sign In</button>
                </div>
                <div style="text-align: center; color: var(--fg-muted); font-size: 14px;">
                    <span id="authToggleText">Don't have an account?</span>
                    <a href="#" onclick="toggleAuthMode()" id="authToggleBtn" style="color: var(--accent-fg); text-decoration: none;">Sign Up</a>
                </div>
            </form>
        </div>
    </div>

    <!-- Create Community Modal -->
    <div class="modal" id="createCommunityModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>üî® Build a New Shed</h3>
                <button class="close-btn" onclick="closeModal('createCommunityModal')">&times;</button>
            </div>
            <form id="createCommunityForm">
                <div class="form-group">
                    <label for="communityName">Community Handle</label>
                    <input type="text" id="communityName" required pattern="[a-z0-9-]+" maxlength="30" placeholder="my-awesome-shed">
                    <small>Lowercase letters, numbers, and hyphens only</small>
                </div>
                <div class="form-group">
                    <label for="communityDisplayName">Display Name</label>
                    <input type="text" id="communityDisplayName" required maxlength="50" placeholder="My Awesome Shed">
                </div>
                <div class="form-group">
                    <label for="communityDescription">Description</label>
                    <textarea id="communityDescription" maxlength="200" placeholder="What's your shed all about?"></textarea>
                </div>
                <div style="text-align: right; margin-top: 20px;">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('createCommunityModal')" style="margin-right: 8px;">Cancel</button>
                    <button type="submit" class="btn" id="createCommunitySubmitBtn">üî® Build Shed</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Compose Modal -->
    <div class="modal" id="composeModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Create Post</h3>
                <button class="close-btn" onclick="closeModal('composeModal')">&times;</button>
            </div>
            
            <!-- Post Type Selector -->
            <div style="display: flex; gap: 8px; margin-bottom: 16px;">
                <button class="btn" onclick="setPostType('text')" style="flex: 1;">üìù Text</button>
                <button class="btn btn-secondary" onclick="setPostType('link')" style="flex: 1;">üîó Link</button>
            </div>
            
            <form id="composeForm">
                <div class="form-group">
                    <label for="postCommunity">Community (Optional)</label>
                    <select id="postCommunity">
                        <option value="">General Feed</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="postTitle">Title</label>
                    <input type="text" id="postTitle" required maxlength="200" placeholder="What's on your mind?">
                </div>
                
                <!-- Text Post Fields -->
                <div id="textPostFields">
                    <div class="form-group">
                        <label for="postContent">Content</label>
                        <textarea id="postContent" rows="6" maxlength="5000" placeholder="Share your thoughts... (Markdown supported)"></textarea>
                    </div>
                </div>
                
                <!-- Link Post Fields -->
                <div id="linkPostFields" style="display: none;">
                    <div class="form-group">
                        <label for="postUrl">URL</label>
                        <input type="url" id="postUrl" placeholder="https://example.com">
                    </div>
                    <div id="mediaPreview"></div>
                    <div class="form-group">
                        <label for="postDescription">Description (Optional)</label>
                        <textarea id="postDescription" rows="3" maxlength="1000" placeholder="Add some context..."></textarea>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="isPrivate"> Private (only visible to you)
                    </label>
                </div>
                
                <div style="text-align: right; margin-top: 20px;">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('composeModal')" style="margin-right: 8px;">Cancel</button>
                    <button type="submit" class="btn" id="composeSubmitBtn">Post</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Edit Profile Modal -->
    <div class="modal" id="editProfileModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Edit Profile</h3>
                <button class="close-btn" onclick="closeModal('editProfileModal')">&times;</button>
            </div>
            <div id="editProfileError"></div>
            <form id="editProfileForm">
                <div class="form-group">
                    <label for="editProfilePicture">Profile Picture URL</label>
                    <input type="url" id="editProfilePicture" placeholder="https://example.com/your-photo.jpg">
                    <small>Enter a URL to an image for your profile picture</small>
                </div>
                <div class="form-group">
                    <label for="editProfileBio">Bio</label>
                    <textarea id="editProfileBio" maxlength="500" placeholder="Tell us about yourself..."></textarea>
                    <small>Max 500 characters</small>
                </div>
                <div style="text-align: right; margin-top: 20px;">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('editProfileModal')" style="margin-right: 8px;">Cancel</button>
                    <button type="submit" class="btn" id="editProfileSubmitBtn">Update Profile</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Settings Modal -->
    <div class="modal" id="settingsModal">
        <div class="modal-content settings-modal-content">
            <div class="settings-header">
                <span class="settings-header-icon">‚öôÔ∏è</span>
                <h3 class="settings-header-title">Settings</h3>
            </div>
            
            <div class="settings-section">
                <h4 class="settings-section-title">
                    <span>üé®</span>
                    <span>Appearance</span>
                </h4>
                
                <div class="settings-option">
                    <div class="settings-option-header">
                        <div>
                            <div class="settings-option-title">Theme</div>
                            <div class="settings-option-description">
                                Choose a color theme that's comfortable for your eyes
                            </div>
                        </div>
                    </div>
                    <select class="theme-selector" id="themeSelector" onchange="handleThemeChange(this.value)">
                        <optgroup label="Dark Themes">
                            <option value="github-dark">GitHub Dark (Default)</option>
                            <option value="solarized-dark">Solarized Dark (Low Contrast)</option>
                            <option value="nord">Nord (Cool & Muted)</option>
                            <option value="dracula">Dracula (Purple Tones)</option>
                            <option value="gruvbox-dark">Gruvbox Dark (Warm Retro)</option>
                        </optgroup>
                        <optgroup label="Light Themes">
                            <option value="github-light">GitHub Light</option>
                            <option value="solarized-light">Solarized Light (Warm)</option>
                            <option value="gruvbox-light">Gruvbox Light (Paper-like)</option>
                            <option value="sepia">Sepia (Eye Comfort)</option>
                        </optgroup>
                        <optgroup label="Special">
                            <option value="high-contrast">High Contrast</option>
                        </optgroup>
                    </select>
                    
                    <div class="theme-preview">
                        <div class="theme-color-box" style="background: var(--bg-canvas);" data-label="Canvas"></div>
                        <div class="theme-color-box" style="background: var(--bg-default);" data-label="Default"></div>
                        <div class="theme-color-box" style="background: var(--accent-fg);" data-label="Accent"></div>
                        <div class="theme-color-box" style="background: var(--success-fg);" data-label="Success"></div>
                    </div>
                </div>
            </div>
            
            <div class="settings-section">
                <h4 class="settings-section-title">
                    <span>üîî</span>
                    <span>Notifications</span>
                </h4>
                
                <div class="settings-option">
                    <div class="settings-option-header">
                        <div>
                            <div class="settings-option-title">Coming Soon</div>
                            <div class="settings-option-description">
                                Notification preferences will be available in a future update
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="settings-section">
                <h4 class="settings-section-title">
                    <span>üîí</span>
                    <span>Privacy</span>
                </h4>
                
                <div class="settings-option">
                    <div class="settings-option-header">
                        <div>
                            <div class="settings-option-title">Coming Soon</div>
                            <div class="settings-option-description">
                                Privacy settings will be available in a future update
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="settings-footer">
                <div class="settings-info">
                    Theme preferences are saved locally
                </div>
                <button class="settings-close-btn" onclick="closeModal('settingsModal')">
                    Close Settings
                </button>
            </div>
        </div>
    </div>

    <!-- Success Message Toast -->
    <div id="successMessage" style="position: fixed; top: 90px; right: 20px; background: var(--success-fg); color: white; padding: 12px 20px; border-radius: 6px; display: none; z-index: 1000; box-shadow: 0 4px 12px rgba(0,0,0,0.3);"></div>

    <!-- Scripts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/11.1.1/marked.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/dompurify/3.0.8/purify.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script src="utils.js"></script>
    <script src="api.js"></script>
    <script src="ui.js"></script>
    <script src="render.js"></script>
    <script src="app.js"></script>
</body>
</html>
